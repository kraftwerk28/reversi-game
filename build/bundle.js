!function(){"use strict";function t(){}const e=t=>t;function n(t){return t()}function o(){return Object.create(null)}function s(t){t.forEach(n)}function r(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t,e){return t!=t?e==e:t!==e}function l(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}const u="undefined"!=typeof window;let a=u?()=>window.performance.now():()=>Date.now(),d=u?t=>requestAnimationFrame(t):t;const f=new Set;function p(t){f.forEach((e=>{e.c(t)||(f.delete(e),e.f())})),0!==f.size&&d(p)}function h(t,e){t.appendChild(e)}function $(t,e,n){t.insertBefore(e,n||null)}function m(t){t.parentNode.removeChild(t)}function g(t){return document.createElement(t)}function v(t){return document.createTextNode(t)}function b(){return v(" ")}function _(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function E(t,e,n){t.classList[n?"add":"remove"](e)}const C=new Set;let x,O=0;function L(t,e,n,o,s,r,i,c=0){const l=16.666/o;let u="{\n";for(let t=0;t<=1;t+=l){const o=e+(n-e)*r(t);u+=100*t+`%{${i(o,1-o)}}\n`}const a=u+`100% {${i(n,1-n)}}\n}`,d=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(a)}_${c}`,f=t.ownerDocument;C.add(f);const p=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(g("style")).sheet),h=f.__svelte_rules||(f.__svelte_rules={});h[d]||(h[d]=!0,p.insertRule(`@keyframes ${d} ${a}`,p.cssRules.length));const $=t.style.animation||"";return t.style.animation=`${$?$+", ":""}${d} ${o}ms linear ${s}ms 1 both`,O+=1,d}function T(t,e){const n=(t.style.animation||"").split(", "),o=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),s=n.length-o.length;s&&(t.style.animation=o.join(", "),O-=s,O||d((()=>{O||(C.forEach((t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}})),C.clear())})))}function N(t){x=t}function B(t){(function(){if(!x)throw new Error("Function called outside component initialization");return x})().$$.on_mount.push(t)}const W=[],A=[],k=[],I=[],q=Promise.resolve();let j=!1;function K(t){k.push(t)}let M=!1;const R=new Set;function H(){if(!M){M=!0;do{for(let t=0;t<W.length;t+=1){const e=W[t];N(e),Q(e.$$)}for(N(null),W.length=0;A.length;)A.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];R.has(e)||(R.add(e),e())}k.length=0}while(W.length);for(;I.length;)I.pop()();j=!1,M=!1,R.clear()}}function Q(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(K)}}let S;function D(t,e,n){t.dispatchEvent(function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(`${e?"intro":"outro"}${n}`))}const P=new Set;let z;function F(){z={r:0,c:[],p:z}}function J(){z.r||s(z.c),z=z.p}function U(t,e){t&&t.i&&(P.delete(t),t.i(e))}function X(t,e,n,o){if(t&&t.o){if(P.has(t))return;P.add(t),z.c.push((()=>{P.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}const Y={duration:0};function G(n,o,i,c){let l=o(n,i),u=c?0:1,h=null,$=null,m=null;function g(){m&&T(n,m)}function v(t,e){const n=t.b-u;return e*=Math.abs(n),{a:u,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function b(o){const{delay:r=0,duration:i=300,easing:c=e,tick:b=t,css:_}=l||Y,y={start:a()+r,b:o};o||(y.group=z,z.r+=1),h||$?$=y:(_&&(g(),m=L(n,u,o,i,r,c,_)),o&&b(0,1),h=v(y,i),K((()=>D(n,o,"start"))),function(t){let e;0===f.size&&d(p),new Promise((n=>{f.add(e={c:t,f:n})}))}((t=>{if($&&t>$.start&&(h=v($,i),$=null,D(n,h.b,"start"),_&&(g(),m=L(n,u,h.b,h.duration,0,c,l.css))),h)if(t>=h.end)b(u=h.b,1-u),D(n,h.b,"end"),$||(h.b?g():--h.group.r||s(h.group.c)),h=null;else if(t>=h.start){const e=t-h.start;u=h.a+h.d*c(e/h.duration),b(u,1-u)}return!(!h&&!$)})))}return{run(t){r(l)?(S||(S=Promise.resolve(),S.then((()=>{S=null}))),S).then((()=>{l=l(),b(t)})):b(t)},end(){g(),h=$=null}}}function V(t){t&&t.c()}function Z(t,e,o){const{fragment:i,on_mount:c,on_destroy:l,after_update:u}=t.$$;i&&i.m(e,o),K((()=>{const e=c.map(n).filter(r);l?l.push(...e):s(e),t.$$.on_mount=[]})),u.forEach(K)}function tt(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function et(t,e){-1===t.$$.dirty[0]&&(W.push(t),j||(j=!0,q.then(H)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function nt(e,n,r,i,c,l,u=[-1]){const a=x;N(e);const d=n.props||{},f=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:o(),dirty:u,skip_bound:!1};let p=!1;if(f.ctx=r?r(e,d,((t,n,...o)=>{const s=o.length?o[0]:n;return f.ctx&&c(f.ctx[t],f.ctx[t]=s)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](s),p&&et(e,t)),n})):[],f.update(),p=!0,s(f.before_update),f.fragment=!!i&&i(f.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);f.fragment&&f.fragment.l(t),t.forEach(m)}else f.fragment&&f.fragment.c();n.intro&&U(e.$$.fragment),Z(e,n.target,n.anchor),H()}N(a)}class ot{$destroy(){tt(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const st={NONE:0,BLACK:1,WHITE:2,BLACK_WON:3,WHITE_WON:4,TIE:5},rt={COORD:1,COLOR:2,ERR:3,SYNC:4,AUTH_TOK:5},it=t=>[t%8,t/8|0],ct=(t,e)=>8*e+t,lt=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];function ut(t){const{move:e,board:n}=t,o=new Map;let s=e===st.BLACK?st.WHITE:st.BLACK;return n.map(((t,e)=>[t,e])).filter((([t])=>t===e)).forEach((([t,e])=>{const[r,i]=it(e);lt.forEach((([t,e])=>{let c=[];for(let l=r+t,u=i+e;l>=0&&l<8&&u>=0&&i<8;l+=t,u+=e){const t=ct(l,u),e=n[t];if(e!==s){if(e===st.NONE){c.length&&o.set(t,c.concat(o.get(t)||[]));break}break}c.push(t)}}))})),o}function at(){const t=Array(64).fill(st.NONE);t[ct(3,3)]=t[ct(4,4)]=st.WHITE,t[ct(4,3)]=t[ct(3,4)]=st.BLACK;const e={move:st.BLACK,board:t,pass:!1,playerColor:void 0,isLoading:!0,singleplayer:!1};return e.possibleMoves=ut(e),e}function dt(t){let e,n,o;return{c(){e=g("div"),y(e,"class","disc b svelte-1pbl36q")},m(t,n){$(t,e,n),o=!0},i(s){o||(K((()=>{n||(n=G(e,t[0],{},!0)),n.run(1)})),o=!0)},o(s){n||(n=G(e,t[0],{},!1)),n.run(0),o=!1},d(t){t&&m(e),t&&n&&n.end()}}}function ft(t){let e,n,o;return{c(){e=g("div"),y(e,"class","disc w svelte-1pbl36q")},m(t,n){$(t,e,n),o=!0},i(s){o||(K((()=>{n||(n=G(e,t[0],{},!0)),n.run(1)})),o=!0)},o(s){n||(n=G(e,t[0],{},!1)),n.run(0),o=!1},d(t){t&&m(e),t&&n&&n.end()}}}function pt(t){let e,n,o,s,r,i=t[1]===st.BLACK&&dt(t),c=t[1]===st.WHITE&&ft(t);return{c(){e=g("div"),i&&i.c(),n=b(),c&&c.c(),y(e,"class","root svelte-1pbl36q")},m(l,u){$(l,e,u),i&&i.m(e,null),h(e,n),c&&c.m(e,null),o=!0,s||(r=_(e,"click",t[2]),s=!0)},p(t,[o]){t[1]===st.BLACK?i?2&o&&U(i,1):(i=dt(t),i.c(),U(i,1),i.m(e,n)):i&&(F(),X(i,1,1,(()=>{i=null})),J()),t[1]===st.WHITE?c?2&o&&U(c,1):(c=ft(t),c.c(),U(c,1),c.m(e,null)):c&&(F(),X(c,1,1,(()=>{c=null})),J())},i(t){o||(U(i),U(c),o=!0)},o(t){X(i),X(c),o=!1},d(t){t&&m(e),i&&i.d(),c&&c.d(),s=!1,r()}}}function ht(t,e,n){let{color:o}=e;return t.$$set=t=>{"color"in t&&n(1,o=t.color)},[(t,{duration:e=300})=>({duration:e,css:(t,e)=>`\n      transform: rotateX(${.5*t}turn)\n                 scale(${2*(t>=.5?e:t)+1});\n      visibility: ${t>=.5?"visible":"hidden"};\n    `}),o,function(e){!function(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t(e)))}(t,e)}]}class $t extends ot{constructor(t){super(),nt(this,t,ht,pt,i,{swapTrn:0,color:1})}get swapTrn(){return this.$$.ctx[0]}}const mt=[];function gt(e,n=t){let o;const s=[];function r(t){if(i(e,t)&&(e=t,o)){const t=!mt.length;for(let t=0;t<s.length;t+=1){const n=s[t];n[1](),mt.push(n,e)}if(t){for(let t=0;t<mt.length;t+=2)mt[t][0](mt[t+1]);mt.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(i,c=t){const l=[i,c];return s.push(l),1===s.length&&(o=n(r)||t),i(e),()=>{const t=s.indexOf(l);-1!==t&&s.splice(t,1),0===s.length&&(o(),o=null)}}}}const vt=gt(at());class bt{constructor(){const t=new WebSocket("ws://127.0.0.1:8080");this._waitConnectedQueue=[],this._connected=!1,t.addEventListener("message",(t=>{this._acceptMessage(t.data)})),t.addEventListener("open",(()=>{this._waitConnectedQueue.forEach((([t,e])=>t())),this._connected=!0})),t.addEventListener("error",(()=>{this._waitConnectedQueue.forEach((([t,e])=>e()))})),this._ws=t,this._awaitMessageQueue=[]}recv(){return new Promise((t=>{this._awaitMessageQueue.push(t)}))}send(t,e){this._ws.send(this._encode(t,e))}_acceptMessage(t){const e=this._decode(t);if(this._awaitMessageQueue.length){this._awaitMessageQueue.shift()(e)}}_decode(t){try{const[e,n]=JSON.parse(t);if(Object.values(rt).includes(e))return{type:e,payload:n};throw new Error}catch{return{type:rt.ERR}}}_encode(t,e){return JSON.stringify([t,e])}waitConnected(){return this._connected?Promise.resolve():new Promise(((t,e)=>{this._waitConnectedQueue.push([t,e])}))}}let _t;async function yt(){return _t||(_t=new bt,await _t.waitConnected()),_t}function wt(t){vt.update((e=>({...e,...t})))}const Et=t=>t.move===st.BLACK?st.WHITE:st.BLACK,Ct=t=>e=>{const n=e.possibleMoves.get(t);if(!n)return e;const o=e.board.slice();o[t]=e.move;for(const t of n)o[t]=e.move;return e.move=Et(e),e.board=o,e.possibleMoves=ut(e),{...e}},xt=t=>{const{board:e,possibleMoves:n}=t;if(e.every((t=>t!==st.NONE))){const n=e.reduce(((t,e)=>t+(e===st.BLACK?1:0)),0);return t.move=32===n?st.TIE:n>32?st.BLACK_WON:st.WHITE_WON,{...t}}return 0===n.size?(t.pass?t.move=st.TIE:(t.move=Et(t),t.pass=!0),{...t}):t};function Ot(){vt.set(at())}function Lt(t){wt({playerColor:t,isLoading:!1})}function Tt({type:t,payload:e}){switch(t){case rt.COORD:{const[t,o]=e;n=ct(t,o),vt.update(Ct(n)),vt.update(xt);break}case rt.COLOR:Lt(e)}var n}function Nt(t){let e,n,o,s,r;return{c(){e=g("div"),n=g("h1"),o=v(t[0]),y(n,"class","svelte-1x575e7"),y(e,"class","root svelte-1x575e7")},m(t,i){$(t,e,i),h(e,n),h(n,o),s||(r=_(e,"click",Ot),s=!0)},p(t,e){1&e&&w(o,t[0])},d(t){t&&m(e),s=!1,r()}}}function Bt(e){let n,o=e[1]&&Nt(e);return{c(){o&&o.c(),n=v("")},m(t,e){o&&o.m(t,e),$(t,n,e)},p(t,[e]){t[1]?o?o.p(t,e):(o=Nt(t),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:t,o:t,d(t){o&&o.d(t),t&&m(n)}}}function Wt(t,e,n){let o,s,r;return l(t,vt,(t=>n(2,o=t))),t.$$.update=()=>{if(4&t.$$.dirty&&n(1,r=[st.TIE,st.BLACK_WON,st.WHITE_WON].includes(o.move)),4&t.$$.dirty)if(o.move===st.TIE)n(0,s="🤷Tie!");else{const t=o.move===st.WHITE_WON?"🌝":"🌚";n(0,s=t+" won!")}},[s,r]}class At extends ot{constructor(t){super(),nt(this,t,Wt,Bt,i,{})}}function kt(e){let n;return{c(){n=g("div"),y(n,"class","marker svelte-i8r4tq"),y(n,"style",e[0]),E(n,"allow",e[1]),E(n,"visible",e[2].visible)},m(t,e){$(t,n,e)},p(t,[e]){1&e&&y(n,"style",t[0]),2&e&&E(n,"allow",t[1]),4&e&&E(n,"visible",t[2].visible)},i:t,o:t,d(t){t&&m(n)}}}const It=gt({visible:!1});function qt(){It.update((t=>({...t,visible:!1})))}function jt(t,e,n){let o,s;l(t,vt,(t=>n(4,o=t))),l(t,It,(t=>n(2,s=t)));let r,{fieldBounds:i}=e,c="";return t.$$set=t=>{"fieldBounds"in t&&n(3,i=t.fieldBounds)},t.$$.update=()=>{if(20&t.$$.dirty&&n(1,r=o.possibleMoves.has(ct(s.x,s.y))),12&t.$$.dirty&&i){const{x:t,y:e}=s;n(0,c=`\n        left: ${t/8*(i.width-14)+2*t}px;\n        top: ${e/8*(i.height-14)+2*e}px;\n      `)}},[c,r,s,i]}class Kt extends ot{constructor(t){super(),nt(this,t,jt,kt,i,{fieldBounds:3})}}function Mt(t,e,n){const o=t.slice();return o[11]=e[n],o[13]=n,o}function Rt(t){let e,n;return e=new $t({props:{color:t[11]}}),e.$on("click",(function(...e){return t[8](t[13],...e)})),{c(){V(e.$$.fragment)},m(t,o){Z(e,t,o),n=!0},p(n,o){t=n;const s={};16&o&&(s.color=t[11]),e.$set(s)},i(t){n||(U(e.$$.fragment,t),n=!0)},o(t){X(e.$$.fragment,t),n=!1},d(t){tt(e,t)}}}function Ht(t){let e;return{c(){e=v("Loading...")},m(t,n){$(t,e,n)},d(t){t&&m(e)}}}function Qt(t){let e,n,o,r,i,c,l,u,a,d,f,p,C,x,O,L,T,N,B,W,A,k,I,q,j,K,M=t[4].board,R=[];for(let e=0;e<M.length;e+=1)R[e]=Rt(Mt(t,M,e));const H=t=>X(R[t],1,1,(()=>{R[t]=null}));B=new Kt({props:{fieldBounds:t[1]}});let Q=t[4].isLoading&&Ht();return I=new At({}),{c(){e=g("div"),n=g("div"),o=g("span"),o.textContent="🌚",r=b(),i=g("span"),i.textContent="👈",c=b(),l=g("span"),l.textContent="🌝",u=b(),a=g("span"),a.textContent=" ",d=b(),f=g("span"),f.textContent="⚪",p=b(),C=g("span"),x=v("x"),O=v(t[5]),L=b(),T=g("div");for(let t=0;t<R.length;t+=1)R[t].c();N=b(),V(B.$$.fragment),W=b(),A=g("div"),Q&&Q.c(),k=b(),V(I.$$.fragment),y(o,"class","svelte-18j4p6q"),y(i,"class","svelte-18j4p6q"),E(i,"iswhite",t[3]),y(l,"class","svelte-18j4p6q"),y(a,"class","svelte-18j4p6q"),y(f,"class","svelte-18j4p6q"),y(C,"class","svelte-18j4p6q"),y(n,"class","game-status svelte-18j4p6q"),y(A,"class","disabled-overlay svelte-18j4p6q"),E(A,"interactionDisabled",t[2]),y(T,"class","field-root svelte-18j4p6q"),E(T,"blurred",t[6]),y(e,"class","field-container svelte-18j4p6q")},m(s,m){$(s,e,m),h(e,n),h(n,o),h(n,r),h(n,i),h(n,c),h(n,l),h(n,u),h(n,a),h(n,d),h(n,f),h(n,p),h(n,C),h(C,x),h(C,O),h(e,L),h(e,T);for(let t=0;t<R.length;t+=1)R[t].m(T,null);h(T,N),Z(B,T,null),h(T,W),h(T,A),Q&&Q.m(A,null),t[9](T),h(e,k),Z(I,e,null),q=!0,j||(K=[_(window,"resize",t[7]),_(T,"mousemove",t[10]),_(T,"mouseleave",qt)],j=!0)},p(t,[e]){if(8&e&&E(i,"iswhite",t[3]),(!q||32&e)&&w(O,t[5]),16&e){let n;for(M=t[4].board,n=0;n<M.length;n+=1){const o=Mt(t,M,n);R[n]?(R[n].p(o,e),U(R[n],1)):(R[n]=Rt(o),R[n].c(),U(R[n],1),R[n].m(T,N))}for(F(),n=M.length;n<R.length;n+=1)H(n);J()}const n={};2&e&&(n.fieldBounds=t[1]),B.$set(n),t[4].isLoading?Q||(Q=Ht(),Q.c(),Q.m(A,null)):Q&&(Q.d(1),Q=null),4&e&&E(A,"interactionDisabled",t[2]),64&e&&E(T,"blurred",t[6])},i(t){if(!q){for(let t=0;t<M.length;t+=1)U(R[t]);U(B.$$.fragment,t),U(I.$$.fragment,t),q=!0}},o(t){R=R.filter(Boolean);for(let t=0;t<R.length;t+=1)X(R[t]);X(B.$$.fragment,t),X(I.$$.fragment,t),q=!1},d(n){n&&m(e),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(R,n),tt(B),Q&&Q.d(),t[9](null),tt(I),j=!1,s(K)}}}function St(t,e,n){let o,s,r;function i(){n(1,r=s?.getBoundingClientRect())}l(t,vt,(t=>n(4,o=t)));let c=!0;let u,a,d;return t.$$.update=()=>{1&t.$$.dirty&&i(),16&t.$$.dirty&&n(3,u=o.move===st.WHITE),16&t.$$.dirty&&n(5,a=64-o.board.filter((t=>t>0)).length),16&t.$$.dirty&&n(6,d=[st.TIE,st.BLACK_WON,st.WHITE_WON].includes(o.move)),16&t.$$.dirty&&(o.isLoading||"number"==typeof o.playerColor&&o.playerColor!==o.move?n(2,c=!0):n(2,c=!1))},[s,r,c,u,o,a,d,i,t=>function(t){vt.update((e=>e.singleplayer?xt(Ct(t)(e)):(yt().then((e=>{e.send(rt.COORD,it(t))})),e)))}(t),function(t){A[t?"unshift":"push"]((()=>{s=t,n(0,s)}))},t=>function(t,e){const{left:n,top:o,width:s,height:r}=e,{clientX:i,clientY:c}=t,[l,u]=[(i-n)/s*8|0,(c-o)/r*8|0];It.update((t=>l===t.x&&u===t.y&&t.visible?t:{...t,x:l,y:u,visible:!0}))}(t,r)]}class Dt extends ot{constructor(t){super(),nt(this,t,St,Qt,i,{})}}function Pt(e){let n,o;return n=new Dt({}),{c(){V(n.$$.fragment)},m(t,e){Z(n,t,e),o=!0},p:t,i(t){o||(U(n.$$.fragment,t),o=!0)},o(t){X(n.$$.fragment,t),o=!1},d(t){tt(n,t)}}}function zt(t){return B((async()=>{try{const t=await yt();console.info("Websocket Connected");const e=await t.recv();for(console.info(e),Lt(e.payload);;){Tt(await t.recv())}}catch(t){wt({isLoading:!1,singleplayer:!0}),console.info("Using singleplayer mode.")}})),[]}new class extends ot{constructor(t){super(),nt(this,t,zt,Pt,c,{})}}({target:document.body})}();
